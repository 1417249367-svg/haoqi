!function(){var e="3.0.0",t="";function n(e,t,n){var o;(o=window.XDomainRequest?new XDomainRequest:window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onload=function(){var e=o.contentType;null==e&&(e=o.getResponseHeader("Content-Type"));var n=o.responseText;e.toLowerCase().indexOf("application/json")>-1&&(n=JSON.parse(n)),"function"==typeof t&&t(n)},o.onerror=function(e){"function"==typeof n?n(e):("undefined"!=typeof console&&console.log(e),alert("截图服务请求出错！"))};var i=60523;"https:"==document.location.protocol&&(i=60524),o.open("get","//127.0.0.1:"+i+"/"+e),o.send()}function o(e,t){var n=this;n.el="object"==typeof e?e:document.getElementById(e),n.options=t||{},n.IsReady=!1,n.options.AutoMinimize?n.AutoMinimize=n.options.AutoMinimize:n.AutoMinimize=!1,n.options.License?n.License=n.options.License:n.License=UDCAPTURE_LICENSE,n.options.FileField&&(n.FileField=n.options.FileField),n.options.FileName&&(n.FileName=n.options.FileName),n.options.TipInfo&&(n.TipInfo=n.options.TipInfo),n.options.UILanguage&&(n.UILanguage=this.options.UILanguage),n.options.OnClick||(n.options.OnClick=function(){n.StartCapture()}),n.el.attachEvent?n.el.attachEvent("onclick",n.options.OnClick):n.el.addEventListener("click",n.options.OnClick,!1),n.Init()}o.prototype={IsReady:!1,Init:function(o){var i=this;i.IsReady?"function"==typeof o&&o():n("regist?product=UdCapture&license="+i.License,function(n){if(0==n.result){if(i._version=n.version,t=n.token,a=i._version,s=e.split("."),p=a.split("."),(parseInt(s[0])>parseInt(p[0])||parseInt(s[0])==parseInt(p[0])&&parseInt(s[1])>parseInt(p[1])||parseInt(s[0])==parseInt(p[0])&&parseInt(s[1])==parseInt(p[1])&&parseInt(s[2])>parseInt(p[2]))&&confirm("屏幕截图客户端组件有新版本v"+e+"，需要升级后才能使用。\r\n是否现在进行升级？"))return void i.StartSetup();i.IsReady=!0,"function"==typeof o&&o(!0)}else alert("截图组件初始化错误："+n.message);var a,s,p},function(e){"undefined"!=typeof console&&console.log(e),confirm("您尚未安装屏幕截图客户端组件，是否现在进行安装？")&&i.StartSetup()})},_udcapPing:function(){var e=this;n("ping?token="+t,function(t){if(0==t.result)switch(t.captureStatus){case 0:setTimeout(function(){e._udcapPing()},300);break;case 1:e.options.OnCaptureCompleted&&e.options.OnCaptureCompleted.call(e);break;case-1:e.options.OnCaptureCanceled&&e.options.OnCaptureCanceled.call(e)}})},_udcap:function(e,o){var i=this;i.Init(function(){var o="capture?token="+t+"&cmd="+e;i.AutoMinimize&&(o+="&minimize=1"),i.FileName&&(o+="&file="+encodeURIComponent(i.FileName)),i.TipInfo&&(o+="&tip="+encodeURIComponent(i.TipInfo)),i.UILanguage&&(o+="&language="+i.UILanguage),n(o,function(e){0==e.result?(i.options.OnBeforeCapture&&i.options.OnBeforeCapture.call(i),setTimeout(function(){i._udcapPing()},300)):alert("启动截图失败："+e.message)})})},StartCapture:function(){this._udcap("")},Capture:function(){this._udcap("cd")},CaptureScreen:function(){this._udcap("cs")},CaptureWindow:function(){this._udcap("cw")},CaptureRect:function(e,t,n,o){this._udcap("cr:"+e+","+t+","+n+","+o)},_uploadPing:function(){var e=this;n("ping?token="+t,function(o){if(0==o.result)switch(o.uploadStatus){case 0:setTimeout(function(){e._uploadPing()},300);break;case 1:n("query?token="+t+"&object=response",function(t){e.options.OnUploadCompleted&&e.options.OnUploadCompleted.call(e,t)});break;case-1:e.options.OnCaptureCanceled&&e.options.OnUploadFailed.call(e)}})},Upload:function(e,o){var i=this;if(null!=e&&""!=e){var a,s=(a=e,a.replace(/^\s+|\s+$/gm,"")).toLowerCase();if(e.length<8||"http://"!=s.substring(0,7)&&"https://"!=s.substring(0,8)&&"ftp://"!=s.substring(0,6)){var p=location.href.split("?")[0];e=p.substring(0,p.lastIndexOf("/")+1)+e}var u="upload?token="+t;i.FileField&&(u+="&FileField="+encodeURIComponent(i.FileField)),e&&(u+="&PostUrl="+encodeURIComponent(e)),null!=o&&(u+="&PostParams="+encodeURIComponent(o)),n(u,function(e){0==e.result?(i.options.OnBeforeUpload&&i.options.OnBeforeUpload.call(i),setTimeout(function(){i._uploadPing()},500)):alert("上传截图失败："+e.message)})}},GetVersion:function(){return this._version},GetBase64:function(e){n("query?token="+t+"&object=base64",function(t){"function"==typeof e&&e(t)})},GetImageUrl:function(){return"//localhost:"+UDSERVICE_PORT+"/query?token="+t+"&object=image"},StartSetup:function(){var e=!1;if(this.options.OnStartSetup&&(e=this.options.OnStartSetup.call(this,UDCAPTURE_SETUP_URL)),!e){var t=document.getElementById("udCaptureSetupFrame");null==t&&((t=document.createElement("iframe")).id="udCaptureSetupFrame",t.style.display="none",document.body.appendChild(t)),t.setAttribute("src",UDCAPTURE_SETUP_URL)}},Destory:function(){this.IsReady&&(n("quit?token="+t),this.IsReady=!1)}},o.Attach=function(e,t){return new o(e,t)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return o}):"undefined"!=typeof module&&module.exports?(module.exports=o.Attach,module.exports.UdCapture=o):window.UdCapture=o}();

//客户端安装文件路径
var UDCAPTURE_SETUP_URL = "UdCapture/UdSvcSetup.msi";
//注册授权许可号
var UDCAPTURE_LICENSE = "";         